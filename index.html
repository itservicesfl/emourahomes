<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Free Home Value Estimate | Emoura Home Value</title>
    <meta name="description" content="Get a fast home value estimate. Enter your address and a few details to receive an instant estimate and a full report option." />
    <style>
        :root {
            /* Light theme (more conventional) */
            --page: #f5f7fb;
            --card: #ffffff;
            --border: #e7eaf2;
            --text: #111827;
            --muted: #4b5563;
            --muted2: #6b7280;
            /* Brand */
            --brand: #2563eb;
            --brand2: #1d4ed8;
            /* Status */
            --danger: #dc2626;
            --ok: #16a34a;
            --radius: 18px;
            --shadow: 0 12px 30px rgba(17, 24, 39, 0.08);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: var(--page);
            color: var(--text);
        }

        .wrap {
            max-width: 1020px;
            margin: 0 auto;
            padding: 42px 18px 60px;
        }

        /* Header branding */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 18px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text);
        }

            .brand img {
                height: 44px;
                width: auto;
                display: block;
            }

            .brand .brandText {
                display: flex;
                flex-direction: column;
                line-height: 1.15;
            }

                .brand .brandText strong {
                    font-size: 14px;
                }

                .brand .brandText span {
                    font-size: 12px;
                    color: var(--muted2);
                }

        .grid {
            display: grid;
            grid-template-columns: 1.25fr 0.75fr;
            gap: 18px;
            align-items: start;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        h1 {
            margin: 0 0 8px;
            font-size: 30px;
            letter-spacing: -0.2px;
        }

        p {
            margin: 0 0 16px;
            line-height: 1.6;
            color: var(--muted);
        }

        .muted {
            font-size: 12px;
            color: var(--muted2);
        }

        /* Progress dots */
        .stepbar {
            display: flex;
            gap: 8px;
            margin: 0 0 16px;
        }

        .dot {
            height: 8px;
            flex: 1;
            border-radius: 999px;
            background: #eef2ff;
            border: 1px solid #e5e7eb;
        }

            .dot.on {
                background: #c7d2fe;
                border-color: #c7d2fe;
            }

        /* Inputs */
        label {
            display: block;
            font-size: 13px;
            color: var(--muted);
            margin: 0 0 6px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 12px;
            border-radius: 12px;
            border: 1px solid #d7dbea;
            background: #ffffff;
            color: var(--text);
            outline: none;
        }

            input::placeholder, textarea::placeholder {
                color: #9ca3af;
            }

            input:focus, select:focus, textarea:focus {
                border-color: rgba(37,99,235,0.55);
                box-shadow: 0 0 0 4px rgba(37,99,235,0.12);
            }

        /* IMPORTANT: Dropdown readability on all browsers */
        select {
            color: var(--text);
            background-color: #ffffff;
        }

        option {
            color: #111827;
            background: #ffffff;
        }

        .row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            min-width: 220px;
        }

        /* Buttons */
        .btnrow {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-block;
            background: var(--brand);
            color: #fff;
            padding: 12px 16px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 800;
            border: 0;
            cursor: pointer;
            transition: transform 0.04s ease, background 0.15s ease;
        }

            .btn:hover {
                background: var(--brand2);
            }

            .btn:active {
                transform: translateY(1px);
            }

            .btn.secondary {
                background: transparent;
                border: 1px solid #d7dbea;
                color: var(--text);
                font-weight: 800;
            }

                .btn.secondary:hover {
                    background: #f3f4f6;
                }

        .error {
            margin-top: 10px;
            color: var(--danger);
            font-size: 13px;
            display: none;
        }

        .ok {
            color: var(--ok);
            font-size: 13px;
            display: none;
            margin-top: 10px;
        }

        .side h3 {
            margin: 0 0 10px;
            font-size: 18px;
        }

        .side ul {
            margin: 0;
            padding-left: 18px;
            color: var(--muted);
            line-height: 1.6;
        }

        .side li {
            margin: 8px 0;
        }

        .badge {
            display: inline-block;
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid #d7dbea;
            color: var(--muted);
            background: #f8fafc;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        .divider {
            height: 1px;
            background: var(--border);
            margin: 16px 0;
        }

        /* Feature chips */
        .chiprow {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .chip {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            padding: 10px 12px;
            border: 1px solid #d7dbea;
            border-radius: 999px;
            background: #f8fafc;
            cursor: pointer;
            user-select: none;
        }

            .chip input {
                width: auto;
            }

        /* Processing */
        .valueBox {
            margin-top: 10px;
            padding: 18px;
            border-radius: 16px;
            border: 1px solid var(--border);
            background: #f8fafc;
        }

        .bar {
            width: 100%;
            height: 12px;
            border-radius: 999px;
            background: #e5e7eb;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

            .bar > div {
                height: 100%;
                width: 0%;
                background: var(--brand);
                transition: width 250ms ease;
            }

        .status {
            margin-top: 10px;
            color: var(--muted);
        }

        /* Result */
        .valueBig {
            font-size: 38px;
            font-weight: 900;
            letter-spacing: -0.3px;
            margin: 6px 0 0;
        }

        .valueSmall {
            color: var(--muted);
            margin: 6px 0 0;
        }

        .urlLink {
            font-family: Arial, sans-serif;
            font-size: 13px;
            color: var(--brand);
            text-decoration: none;
            font-weight: 800;
        }

            .urlLink:hover {
                text-decoration: underline;
            }
    </style>
</head>
<body>
    <div class="wrap">

        <!-- Branding header (logo + trust line) -->
        <div class="topbar">
            <a class="brand" href="#" onclick="return false;">
                <img src="assets/logo.png" alt="Emoura Home Value Logo" />
                <div class="brandText">
                    <strong>Emoura Home Value</strong>
                    <span>Nationwide USA • Fast estimate</span>
                </div>
            </a>
            <div class="muted">Secure lead form • No spam</div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="stepbar" aria-label="Progress">
                    <div class="dot on" id="dot1"></div>
                    <div class="dot" id="dot2"></div>
                    <div class="dot" id="dot3"></div>
                    <div class="dot" id="dot4"></div>
                </div>

                <h1>Get your home value estimate</h1>
                <p id="subtitle">Start by entering the property address. Then we’ll ask a few quick details and generate an estimate.</p>

                <!-- STEP 1 -->
                <form id="step1">
                    <div class="row">
                        <div class="col">
                            <label for="address">Property address</label>
                            <input id="address" name="address" placeholder="123 Main St, City, State" autocomplete="street-address" />
                        </div>

                        <div class="col">
                            <label for="ptype">Property type</label>
                            <select id="ptype" name="ptype">
                                <option value="">Select…</option>
                                <option>Single-family home</option>
                                <option>Condo / Apartment</option>
                                <option>Townhome</option>
                                <option>Multi-family</option>
                                <option>Land</option>
                                <option>Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="btnrow">
                        <button class="btn" type="submit">Continue</button>
                        <span class="muted">Step 1 of 4</span>
                    </div>

                    <div class="error" id="err1"></div>
                    <div class="ok" id="ok1"></div>
                </form>

                <!-- STEP 2 -->
                <form id="step2" class="hidden">
                    <div class="row">
                        <div class="col">
                            <label for="sqft">Total living area (sqft)</label>
                            <input id="sqft" name="sqft" inputmode="numeric" placeholder="e.g., 1850" />
                        </div>
                        <div class="col">
                            <label for="beds">Bedrooms</label>
                            <input id="beds" name="beds" inputmode="numeric" placeholder="e.g., 3" />
                        </div>
                        <div class="col">
                            <label for="baths">Bathrooms</label>
                            <input id="baths" name="baths" inputmode="decimal" placeholder="e.g., 2 or 2.5" />
                        </div>
                    </div>

                    <div class="divider"></div>

                    <label>Features</label>
                    <div class="chiprow">
                        <label class="chip"><input type="checkbox" id="balcony" /> Balcony / Patio</label>
                        <label class="chip"><input type="checkbox" id="pool" /> Pool</label>
                        <label class="chip"><input type="checkbox" id="kitchen" /> Updated Kitchen</label>
                        <label class="chip"><input type="checkbox" id="living" /> Large Living Room</label>
                    </div>

                    <div class="row" style="margin-top:14px;">
                        <div class="col">
                            <label for="garageSpots">Garage / Parking spots</label>
                            <select id="garageSpots">
                                <option value="">Select…</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3+</option>
                            </select>
                        </div>

                        <div class="col">
                            <label for="hoa">Condo/HOA fee?</label>
                            <select id="hoa">
                                <option value="">Select…</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>

                        <div class="col" id="hoaAmountWrap" style="display:none;">
                            <label for="hoaAmount">Monthly HOA/Condo fee (USD)</label>
                            <input id="hoaAmount" inputmode="numeric" placeholder="e.g., 650" />
                        </div>
                    </div>

                    <div class="btnrow">
                        <button class="btn secondary" type="button" id="backTo1">Back</button>
                        <button class="btn" type="submit">Continue</button>
                        <span class="muted">Step 2 of 4</span>
                    </div>

                    <div class="error" id="err2"></div>
                    <div class="ok" id="ok2"></div>
                </form>

                <!-- STEP 3: PROCESSING -->
                <div id="step3" class="hidden">
                    <div class="valueBox">
                        <div class="muted">Processing</div>
                        <div style="font-size:20px;font-weight:900;margin-top:6px;">We’re evaluating your property…</div>

                        <div style="margin-top:12px;">
                            <div class="bar"><div id="barFill"></div></div>
                            <div class="status" id="statusLine">Starting analysis…</div>
                        </div>

                        <div class="btnrow" style="margin-top:18px;">
                            <button class="btn secondary" id="backTo2" type="button">Back</button>
                            <span class="muted">Step 3 of 4</span>
                        </div>
                    </div>
                </div>

                <!-- STEP 4: RESULT + CTAs (FINAL) -->
                <div id="step4" class="hidden">
                    <div class="valueBox">
                        <div class="muted">Evaluation Complete</div>
                        <div style="font-size:20px;font-weight:900;margin-top:6px;">Your Home Worth is</div>
                        <div class="valueBig" id="estimateValue">$—</div>
                        <div class="valueSmall" id="estimateRange">Estimated range: —</div>
                    </div>

                    <div class="divider"></div>

                    <div class="row">
                        <div class="col">
                            <h3 style="margin:0 0 10px;">Email me the full report</h3>
                            <form id="emailCta">
                                <label for="name1">Full name</label>
                                <input id="name1" placeholder="Your name" />
                                <div style="height:10px;"></div>
                                <label for="email1">Email</label>
                                <input id="email1" type="email" placeholder="you@email.com" />
                                <div class="btnrow">
                                    <button class="btn" type="submit">Send report</button>
                                </div>
                                <div class="error" id="errEmail"></div>
                                <div class="ok" id="okEmail"></div>
                            </form>
                        </div>

                        <div class="col">
                            <h3 style="margin:0 0 10px;">Talk to a specialist</h3>
                            <form id="callCta">
                                <label for="name2">Full name</label>
                                <input id="name2" placeholder="Your name" />
                                <div style="height:10px;"></div>
                                <label for="phone2">Phone</label>
                                <input id="phone2" placeholder="(555) 555-5555" />
                                <div style="height:10px;"></div>
                                <label for="best2">Best time to call</label>
                                <select id="best2">
                                    <option value="">Select…</option>
                                    <option>Morning</option>
                                    <option>Afternoon</option>
                                    <option>Evening</option>
                                </select>
                                <div class="btnrow">
                                    <button class="btn" type="submit">Request call</button>
                                </div>
                                <div class="error" id="errCall"></div>
                                <div class="ok" id="okCall"></div>
                            </form>
                        </div>
                    </div>

                    <div class="btnrow" style="margin-top:16px;">
                        <a class="btn" id="finishLink" href="https://www.emourahomes.com">Continue to www.emourahomes.com</a>
                        <span class="muted">Step 4 of 4</span>
                    </div>

                    <!-- show url only on step 4 -->
                    <div class="muted" style="margin-top:10px;">
                        Main website:
                        <a class="urlLink" href="https://www.emourahomes.com" target="_blank" rel="noreferrer">www.emourahomes.com</a>
                    </div>
                </div>

                <div class="muted" style="margin-top:18px;">
                    By continuing, you agree that this is an estimate based on information provided and local market averages.
                </div>
            </div>

            <div class="card side">
                <div class="badge">How it works</div>
                <h3>Fast & simple</h3>
                <ul>
                    <li>Enter your address</li>
                    <li>Add property details (sqft, beds, baths, amenities)</li>
                    <li>We compare with similar properties nationwide</li>
                    <li>You get an estimate + option for full report</li>
                </ul>
                <div class="muted" style="margin-top:14px;">
                    Next: we’ll connect this flow to the backend API.
                </div>
            </div>
        </div>
    </div>

    <script>
        const $ = (id) => document.getElementById(id);

        const step1 = $('step1');
        const step2 = $('step2');
        const step3 = $('step3');
        const step4 = $('step4');

        const err1 = $('err1');
        const ok1 = $('ok1');
        const err2 = $('err2');
        const ok2 = $('ok2');

        function setDots(activeStep) {
            for (let i = 1; i <= 4; i++) {
                const d = $('dot' + i);
                if (!d) continue;
                d.classList.toggle('on', i <= activeStep);
            }
        }

        function showError(el, msg) { el.textContent = msg; el.style.display = 'block'; }
        function hideError(el) { el.style.display = 'none'; el.textContent = ''; }
        function showOk(el, msg) { el.textContent = msg; el.style.display = 'block'; }
        function hideOk(el) { el.style.display = 'none'; el.textContent = ''; }

        function getDraft() {
            try { return JSON.parse(localStorage.getItem('emhv_lead_draft') || '{}'); }
            catch { return {}; }
        }
        function setDraft(patch) {
            const cur = getDraft();
            const next = { ...cur, ...patch, updatedAt: new Date().toISOString() };
            localStorage.setItem('emhv_lead_draft', JSON.stringify(next));
            return next;
        }

        function showOnly(which) {
            [step1, step2, step3, step4].forEach(el => el.classList.add('hidden'));
            which.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function goStep(n) {
            if (n === 1) { setDots(1); $('subtitle').textContent = 'Start by entering the property address. Then we’ll ask a few quick details and generate an estimate.'; showOnly(step1); }
            if (n === 2) { setDots(2); $('subtitle').textContent = 'Add a few property details so the estimate is more accurate.'; showOnly(step2); }
            if (n === 3) { setDots(3); $('subtitle').textContent = 'We are evaluating properties like yours in the area.'; showOnly(step3); startProcessing(); }
            if (n === 4) { setDots(4); $('subtitle').textContent = 'Your estimate is ready. Choose how you want the full evaluation.'; showOnly(step4); }
        }

        // Prefill from draft
        (function prefill() {
            const d = getDraft();
            if (d.address) $('address').value = d.address;
            if (d.ptype) $('ptype').value = d.ptype;
            if (d.sqft) $('sqft').value = d.sqft;
            if (d.beds) $('beds').value = d.beds;
            if (d.baths) $('baths').value = d.baths;
            if (d.features) {
                $('balcony').checked = !!d.features.balcony;
                $('pool').checked = !!d.features.pool;
                $('kitchen').checked = !!d.features.kitchen;
                $('living').checked = !!d.features.living;
            }
            if (typeof d.garageSpots !== 'undefined' && d.garageSpots !== null) $('garageSpots').value = String(d.garageSpots);
            if (d.hoa) $('hoa').value = d.hoa;
            if (d.hoa === 'yes') $('hoaAmountWrap').style.display = 'block';
            if (d.hoaAmount) $('hoaAmount').value = d.hoaAmount;
        })();

        // STEP 1 submit
        step1.addEventListener('submit', (e) => {
            e.preventDefault();
            hideError(err1); hideOk(ok1);

            const address = $('address').value.trim();
            const ptype = $('ptype').value.trim();

            if (!address || address.length < 6) return showError(err1, 'Please enter a valid property address.');
            if (!ptype) return showError(err1, 'Please select a property type.');

            setDraft({ address, ptype, startedAt: getDraft().startedAt || new Date().toISOString() });
            showOk(ok1, 'Saved. Continue to add property details.');
            goStep(2);
        });

        // HOA show/hide amount
        $('hoa').addEventListener('change', () => {
            const v = $('hoa').value;
            $('hoaAmountWrap').style.display = (v === 'yes') ? 'block' : 'none';
            if (v !== 'yes') $('hoaAmount').value = '';
        });

        // Back buttons
        $('backTo1').addEventListener('click', () => goStep(1));
        $('backTo2').addEventListener('click', () => goStep(2));

        // STEP 2 submit
        step2.addEventListener('submit', (e) => {
            e.preventDefault();
            hideError(err2); hideOk(ok2);

            const sqft = $('sqft').value.trim();
            const beds = $('beds').value.trim();
            const baths = $('baths').value.trim();

            const sqftNum = Number(sqft);
            if (!sqft || Number.isNaN(sqftNum) || sqftNum < 200) return showError(err2, 'Please enter a valid sqft (example: 1850).');

            const bedsNum = Number(beds);
            if (!beds || Number.isNaN(bedsNum) || bedsNum < 0 || bedsNum > 30) return showError(err2, 'Please enter valid bedrooms (example: 3).');

            const bathsNum = Number(baths);
            if (!baths || Number.isNaN(bathsNum) || bathsNum < 0 || bathsNum > 30) return showError(err2, 'Please enter valid bathrooms (example: 2 or 2.5).');

            const features = {
                balcony: $('balcony').checked,
                pool: $('pool').checked,
                kitchen: $('kitchen').checked,
                living: $('living').checked
            };

            const garageSpots = $('garageSpots').value === '' ? null : Number($('garageSpots').value);
            const hoa = $('hoa').value;
            let hoaAmount = null;

            if (!hoa) return showError(err2, 'Please select whether there is a Condo/HOA fee.');
            if (hoa === 'yes') {
                const amt = $('hoaAmount').value.trim();
                const amtNum = Number(amt);
                if (!amt || Number.isNaN(amtNum) || amtNum < 1) return showError(err2, 'Please enter a valid monthly HOA amount.');
                hoaAmount = amtNum;
            }

            setDraft({ sqft: sqftNum, beds: bedsNum, baths: bathsNum, features, garageSpots, hoa, hoaAmount });
            showOk(ok2, 'Saved. Generating estimate…');
            goStep(3);
        });

        // Mock estimate logic (temporary)
        

        // Processing animation
        let processingRunning = false;

        async function startProcessing() {
            if (processingRunning) return;
            processingRunning = true;

            const barFill = $('barFill');
            const statusLine = $('statusLine');

            const messages = [
                'Verifying the address…',
                'Gathering market averages…',
                'Comparing similar properties…',
                'Adjusting for size and features…',
                'Analyzing HOA/condo costs…',
                'Finalizing your estimate…'
            ];

            let pct = 0;
            let msgIndex = 0;
            statusLine.textContent = messages[0];
            barFill.style.width = '0%';

            while (pct < 100) {
                await wait(250);
                pct += 4;
                if (pct > 100) pct = 100;

                barFill.style.width = pct + '%';

                if (pct % 16 === 0 && msgIndex < messages.length - 1) {
                    msgIndex++;
                    statusLine.textContent = messages[msgIndex];
                }
            }

            try {
                const d = getDraft();

                const resp = await fetch('/api/estimate', {
                    method: 'POST',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify({
                        address: d.address,
                        ptype: d.ptype,
                        sqft: d.sqft,
                        beds: d.beds,
                        baths: d.baths,
                        features: d.features,
                        garageSpots: d.garageSpots,
                        hoa: d.hoa,
                        hoaAmount: d.hoaAmount
                    })
                });

                const est = await resp.json();
                if (!resp.ok) throw new Error(est?.error || 'Estimate failed');

                const format = (n) => Number(n).toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });

                $('estimateValue').textContent = format(est.value);
                $('estimateRange').textContent = `Estimated range: ${format(est.low)} – ${format(est.high)}`;

                setDraft({ estimate: { value: est.value, low: est.low, high: est.high, mode: est.mode, isMock: false } });
                goStep(4);
            } catch (e) {
                statusLine.textContent = 'We could not generate an estimate right now. Please go back and try again.';
            } finally {
                processingRunning = false;
            }
        }

        function wait(ms) { return new Promise(res => setTimeout(res, ms)); }

        function clearCtaMessages() {
            const ids = ['errEmail', 'okEmail', 'errCall', 'okCall'];
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.style.display = 'none';
                    el.textContent = '';
                }
            });
        }

        function showCtaError(id, msg) {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = msg;
            el.style.display = 'block';
        }

        function showCtaOk(id, msg) {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = msg;
            el.style.display = 'block';
        }



        // CTA Forms (temporary)
        $('emailCta').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearCtaMessages();

            const d = getDraft();
            const name = $('name1').value.trim();
            const email = $('email1').value.trim();

            if (!name) return showCtaError('errEmail', 'Please enter your name.');
            if (!email || !email.includes('@')) return showCtaError('errEmail', 'Please enter a valid email.');

            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Sending...';

            const payload = {
                leadChoice: 'email_report',
                lead: { name, email },

                address: d.address,
                ptype: d.ptype,
                sqft: d.sqft,
                beds: d.beds,
                baths: d.baths,
                features: d.features,
                garageSpots: d.garageSpots,
                hoa: d.hoa,
                hoaAmount: d.hoaAmount,

                estimate: d.estimate
            };

            try {
                const resp = await fetch('/api/lead', {
                    method: 'POST',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const out = await resp.json();
                if (!resp.ok) throw new Error(out?.error || 'Lead submit failed');

                showCtaOk('okEmail', 'Sent! Redirecting to www.emourahomes.com…');
                localStorage.removeItem('emhv_lead_draft');
                setTimeout(() => { window.location.href = 'https://www.emourahomes.com'; }, 900);
            } catch (err) {
                showCtaError('errEmail', 'Could not send right now. Please try again.');
                btn.disabled = false;
                btn.textContent = 'Send report';
            }
        });


        $('callCta').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearCtaMessages();

            const d = getDraft();
            const name = $('name2').value.trim();
            const phone = $('phone2').value.trim();
            const best = $('best2').value.trim();

            if (!name) return showCtaError('errCall', 'Please enter your name.');
            if (!phone || phone.length < 7) return showCtaError('errCall', 'Please enter a valid phone number.');
            if (!best) return showCtaError('errCall', 'Please select the best time to call.');

            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Sending...';

            const payload = {
                leadChoice: 'specialist_call',
                lead: { name, phone, best },

                address: d.address,
                ptype: d.ptype,
                sqft: d.sqft,
                beds: d.beds,
                baths: d.baths,
                features: d.features,
                garageSpots: d.garageSpots,
                hoa: d.hoa,
                hoaAmount: d.hoaAmount,

                estimate: d.estimate
            };

            try {
                const resp = await fetch('/api/lead', {
                    method: 'POST',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const out = await resp.json();
                if (!resp.ok) throw new Error(out?.error || 'Lead submit failed');

                showCtaOk('okCall', 'Sent! Redirecting to www.emourahomes.com…');
                localStorage.removeItem('emhv_lead_draft');
                setTimeout(() => { window.location.href = 'https://www.emourahomes.com'; }, 900);
            } catch (err) {
                showCtaError('errCall', 'Could not send right now. Please try again.');
                btn.disabled = false;
                btn.textContent = 'Request call';
            }
        });


        // Auto-step
        (function autoStep() {
            // Always start a new session at Step 1
            goStep(1);
        })();

    </script>
</body>
</html>
