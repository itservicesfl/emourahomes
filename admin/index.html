<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EMouraHomes Admin</title>

    <style>
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#020617; color:#e5e7eb; }
      .wrap { padding: 18px; }
      .ok { color: #22c55e; }
      .bad { color: #ef4444; }
      code { background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 6px; }
    </style>

    <script>
      window.CMS_MANUAL_INIT = true;
    </script>

    <script src="https://unpkg.com/decap-cms@latest/dist/decap-cms.js"></script>
  </head>
  <body>
    <div class="wrap" id="status">
      <div>Loading admin…</div>
    </div>

    <script>
      const el = document.getElementById("status");

      function show(msg, cls) {
        el.innerHTML = `<div class="${cls}">${msg}</div>`;
      }

      // Check script loaded
      if (!window.CMS) {
        show('❌ Decap CMS did NOT load. The script may be blocked. Try another browser or check Console errors.', 'bad');
      } else {
        show('✅ Decap CMS loaded. Now checking for <code>/admin/config.yml</code> …', 'ok');

        fetch('/admin/config.yml', { cache: "no-store" })
          .then(r => {
            if (!r.ok) throw new Error("config.yml not found or not accessible");
            return r.text();
          })
          .then(text => {
            if (!text || text.trim().length < 10) throw new Error("config.yml is empty");
            show('✅ <code>/admin/config.yml</code> found. Initializing CMS…', 'ok');
            window.CMS.init();
          })
          .catch(err => {
            show('❌ Problem loading <code>/admin/config.yml</code>. Make sure it exists and is valid YAML. Error: ' + err.message, 'bad');
          });
      }
    </script>
  </body>
</html>
